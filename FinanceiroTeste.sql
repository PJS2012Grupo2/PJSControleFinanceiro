create database FINANCEIRO;

USE FINANCEIRO;
GO

--CRIANDO TABELAS

CREATE TABLE CATEGORIA (
   ID_CATEGORIA INT PRIMARY KEY NOT NULL IDENTITY,
   NOME VARCHAR(50) NOT NULL,
   LIMITE MONEY NOT NULL
);

CREATE TABLE MOVIMENTO (
  ID_MOVIMENTO INT PRIMARY KEY NOT NULL IDENTITY,
  DESCRICAO VARCHAR(50) NOT NULL,
  VALOR MONEY NOT NULL,
  DATA_CADASTRO DATE NOT NULL,
  PARCELA INT,
  VALOR_TOTAL AS (VALOR * PARCELA),
  ID_CATEGORIA INT FOREIGN KEY REFERENCES CATEGORIA(ID_CATEGORIA)
  );

CREATE TABLE MOVIMENTO_RECORRENTE(
  ID_RECORRENTE INT PRIMARY KEY NOT NULL identity,
  DESCRICAO VARCHAR(50),
  VALOR FLOAT,
  RECORRENCIA VARCHAR(20),
  ID_CATEGORIA INT FOREIGN KEY REFERENCES CATEGORIA(ID_CATEGORIA)
);
GO

--CREATE TABLE PARCELA(
 -- ID_PARCELA INT PRIMARY KEY NOT NULL identity,
 -- QUANTIDADE INT,
 -- ID_MOVIMENTO INT FOREIGN KEY REFERENCES MOVIMENTO(ID_MOVIMENTO)
);

--Inserindo alguns registros para teste
INSERT into CATEGORIA values ('Casa', 200.00);
insert into CATEGORIA VALUES ('Carro', 230.00);
INSERT INTO CATEGORIA VALUES ('Limpeza', 100.00);
insert into CATEGORIA VAlUES ('Cachorros',50.00 );

INSERT INTO MOVIMENTO_RECORRENTE VALUES ('Fatura', 90.00, 'Mensal', 1);
INSERT INTO MOVIMENTO_RECORRENTE VALUES ('Compras', 60.00, 'Semanal', 1);

--Inserindo alguns registros para teste
INSERT INTO MOVIMENTO VALUES ('Cera ',10.00,'10-02-2012', 1, 2);
insert into MOVIMENTO VAlUES ('Racao',49.99, '12-31-2011', 3, 4);
INSERT INTO MOVIMENTO VALUES ('Coca Cola', 3.00, '02-12-2011',3,3);

--insert into PARCELA values (2,3);

select * from MOVIMENTO;
go
SELECT * FROM CATEGORIA;

SELECT M.ID_MOVIMENTO,
       M.DESCRICAO,
       M.VALOR,
       M.DATA_CADASTRO,
       M.PARCELA,
       C.NOME as [CATEGORIA]      
 FROM MOVIMENTO M INNER JOIN CATEGORIA C
 on
     M.ID_CATEGORIA = C.ID_CATEGORIA
 WHERE M.DESCRICAO LIKE 'Cer%';
 go
 
 SELECT M.ID_MOVIMENTO,
       M.DESCRICAO,
       M.VALOR,
       M.DATA_CADASTRO,
       M.PARCELA,
       C.NOME as [CATEGORIA]      
 FROM MOVIMENTO M INNER JOIN CATEGORIA C
 on
     M.ID_CATEGORIA = C.ID_CATEGORIA
 WHERE M.DATA_CADASTRO BETWEEN '2012-10-02' 
 AND '2012-12-02'
 go
 
  SELECT M.ID_MOVIMENTO,
       M.DESCRICAO,
       M.VALOR,
       M.DATA_CADASTRO,
       M.PARCELA,
       C.NOME as [CATEGORIA]      
 FROM MOVIMENTO M INNER JOIN CATEGORIA C
 on
     M.ID_CATEGORIA = C.ID_CATEGORIA
 WHERE C.NOME like 'C%';
 
select * from CATEGORIA where limite = (select MAX(limite) from CATEGORIA);
 
select * from MOVIMENTO where VALOR = (select MAX(valor) from MOVIMENTO);

select * from CATEGORIA where limite = (select Min(limite) from CATEGORIA);
 
select * from MOVIMENTO where VALOR = (select Min(valor) from MOVIMENTO);

insert into MOVIMENTO values ('Detergente', 2.00,'10-11-2011', 1, 2);
